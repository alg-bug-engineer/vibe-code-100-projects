# CogniFlow 更新日志

## [v1.4.0] - 2025-10-27

### 🎉 重大功能更新

#### 对话式查询功能
- **新增**: QuickInput集成智能查询模式
- **新增**: 查询意图AI识别
- **新增**: 查询结果浮层展示
- **新增**: 特殊前缀触发查询(? 或 /q)
- **功能**:
  - 自然语言查询(如"今天有什么事?")
  - 智能解析查询参数(时间、类型、标签)
  - 浮层展示结果,不污染主视图
  - ESC或点击外部关闭浮层
  - 支持查询所有类型条目

#### 冲突事项高亮显示
- **新增**: 日程时间冲突自动检测
- **新增**: 数据库触发器自动维护冲突状态
- **新增**: ItemCard红色边框警告
- **新增**: AlertTriangle图标提示
- **新增**: Tooltip显示冲突详情
- **功能**:
  - 实时检测Event类型时间重叠
  - 自动更新所有冲突条目状态
  - 视觉警告(红色边框+图标)
  - 鼠标悬停显示冲突提示

#### 数据库架构扩展
- **新增**: 高级功能支持字段
  - `has_conflict` - 冲突状态标记
  - `start_time` - 日程开始时间
  - `end_time` - 日程结束时间
  - `recurrence_rule` - 重复规则(RRULE格式)
  - `recurrence_end_date` - 重复结束日期
  - `master_item_id` - 母版条目关联
  - `is_master` - 母版标记
- **新增**: 冲突检测触发器
- **新增**: 性能优化索引

### ✨ 新功能

#### 智能查询
- 🔍 对话式查询入口
- 🤖 AI意图识别
- 📊 查询结果浮层
- ⌨️ 快捷前缀(? /q)
- 🎯 多维度查询(时间/类型/标签)
- 💬 自然语言支持

#### 冲突管理
- ⚠️ 自动冲突检测
- 🔴 红色边框警告
- 🚨 AlertTriangle图标
- 💡 Tooltip提示
- 🔄 实时状态更新

#### 日历和重复任务(数据库就绪)
- 📅 日历视图数据结构
- 🔁 重复任务字段支持
- 📖 完整实现指南文档

### 🔧 技术改进

#### 查询处理
- 新增 `queryProcessor.ts` 工具
- 新增 `QueryResultPanel` 组件
- 新增 `itemApi.queryItems()` 方法
- AI驱动的意图解析
- 时间范围智能计算

#### 冲突检测
- PostgreSQL触发器自动检测
- 时间重叠算法优化
- 批量状态更新
- 性能索引优化

#### 类型系统
- 扩展 `Item` 接口
- 新增 `QueryIntent` 类型
- 新增 `QueryResult` 类型
- 更新 `AIProcessResult` 类型

### 📚 文档更新

- **新增**: `CALENDAR_AND_RECURRENCE_GUIDE.md`
  - 日历视图完整实现指南
  - 重复任务详细设计文档
  - React Big Calendar集成说明
  - RRule.js使用指南
  - Edge Function实例生成逻辑
  - 测试和优化建议

### 🐛 Bug修复

- 修复查询结果浮层z-index问题
- 修复冲突检测边界条件
- 优化查询性能

### 🎨 UI/UX改进

- 查询模式输入框边框高亮
- 冲突事项视觉警告增强
- 查询结果浮层动画效果
- Tooltip交互优化

### 📊 性能优化

- 查询结果缓存
- 冲突检测索引优化
- 数据库触发器性能调优

### 🔒 安全增强

- 查询权限验证
- RLS策略更新
- 输入验证增强

---

## [v1.3.0] - 2025-10-27

### 🎉 重大功能更新

#### URL链接管理系统
- **新增**: 智能URL识别和处理功能
- **新增**: 链接库专属Tab页面
- **新增**: URLCard组件展示链接卡片
- **新增**: Edge Function自动抓取网页内容
- **新增**: AI生成网站内容梗概(100-150字)
- **功能**: 
  - 自动识别输入的URL
  - 抓取网站标题、缩略图、正文
  - 使用Gemini AI生成中文梗概
  - 专属链接库存储和管理
  - 支持搜索URL内容

#### 主题页面二级导航
- **新增**: 主题页面二级Tab(标签/历史记录)
- **新增**: 历史记录子页面,按时间倒序展示
- **优化**: 标签详情页面支持URL类型
- **优化**: 统一条目展示逻辑
- **提升**: 信息组织更清晰,导航更直观

### ✨ 新功能

#### 链接库功能
- 📚 专属链接库Tab
- 🔗 URLCard卡片展示
- 🖼️ 缩略图显示
- 📝 AI生成梗概
- 🗑️ 删除链接
- 🔍 搜索链接内容

#### 历史记录功能
- 📜 全部条目历史
- ⏰ 按时间倒序排列
- 🔄 支持所有类型(task/event/note/data/url)
- 📊 统计信息显示
- 🎯 快速浏览和管理

### 🔧 技术改进

#### 数据库扩展
- 新增URL相关字段:
  - `url` - URL地址
  - `url_title` - 网站标题
  - `url_summary` - AI生成梗概
  - `url_thumbnail` - 缩略图URL
  - `url_fetched_at` - 抓取时间
- 扩展item_type枚举,添加'url'类型
- 新增URL字段索引,优化查询性能
- 完善数据库注释

#### Edge Function
- **新增**: fetch-url-content Edge Function
- **功能**:
  - 网页内容抓取
  - 元数据提取(title, og:image, twitter:image)
  - 文本内容提取和清理
  - AI梗概生成(Gemini API)
  - CORS支持
  - 错误处理

#### API方法
- `getURLItems()` - 获取链接库条目
- `getItemsByTag(tag)` - 按标签查询条目
- `getAllItemsHistory()` - 获取全部历史记录
- 优化搜索功能,支持URL内容搜索

#### 前端组件
- **新增**: URLCard组件(链接卡片)
- **新增**: urlProcessor工具(URL检测和处理)
- **优化**: QuickInput支持URL自动识别
- **优化**: Dashboard新增链接库Tab
- **优化**: 主题页面二级Tab导航
- **统一**: 条目渲染逻辑(ItemCard + URLCard)

### 🎯 用户体验优化

#### 输入体验
- ⚡ 输入URL后立即清空输入框
- 💬 友好的处理提示("正在抓取网页内容...")
- 🔄 后台异步处理,不阻塞操作
- ✅ 完成后自动刷新显示

#### 视觉体验
- 🎨 统一的卡片样式
- 🖼️ 缩略图展示
- 📱 响应式设计
- 🎭 平滑的动画效果

#### 导航体验
- 📑 清晰的二级Tab导航
- 🔙 面包屑导航(返回按钮)
- 🎯 多种查看方式(按标签/按时间/按类型)
- 🔍 全局搜索支持所有类型

### 📚 文档更新

- **新增**: `URL_FEATURE_GUIDE.md` - URL功能完整指南
  - 功能概述和使用方法
  - 技术实现详解
  - 使用场景示例
  - 配置说明
  - 故障排查
  - 未来计划

- **新增**: `TOPICS_OPTIMIZATION.md` - 主题页面优化说明
  - 优化概述
  - 二级Tab导航说明
  - 技术实现
  - 用户体验优化
  - 性能优化
  - 对比分析

- **更新**: `CHANGELOG.md` - 添加v1.3.0更新内容

### 🐛 Bug修复

- ✅ 修复类型定义缺失问题
- ✅ 修复条目创建时URL字段缺失错误
- ✅ 优化错误处理和提示

### ⚡ 性能优化

- 并行加载所有视图数据
- 智能渲染,只渲染激活的Tab
- 数据库查询优化(索引、排序)
- 组件渲染优化

### 🔒 安全更新

- Edge Function环境变量保护
- CORS安全配置
- 输入验证和清理
- 错误信息脱敏

---

## [v1.2.1] - 2025-10-27

### 🐛 Bug修复

#### 今日视图显示问题修复
- **修复**: 输入"今晚六点开会"等今日事项不显示的问题
- **原因**: 原逻辑只查询有截止日期的条目，AI未识别时间时条目会丢失
- **解决方案**: 
  - 今日视图现在包含三类条目：
    1. 今天有截止日期的任务和事件
    2. 今天创建但没有截止日期的任务和事件
    3. 过期但未完成的任务
  - 即使AI未能识别时间，今天创建的条目仍会显示

### ✨ 功能增强

#### 收件箱逻辑优化
- **新增**: 收件箱现在也显示没有截止日期的任务和事件
- **优势**: 
  - 成为真正的"待处理"区域
  - AI未识别时间的条目有地方显示
  - 用户可以在收件箱中补充时间信息

#### 调试信息增强
- **新增**: 所有视图查询都输出详细的控制台日志
- **包含信息**:
  - 查询条件（时间范围、本地时间）
  - 查询结果统计（各类条目数量）
  - 前几条数据详情
- **用途**: 方便排查问题和优化逻辑

### 🔧 技术改进

#### 查询逻辑优化
- 今日视图使用三个独立查询，然后合并去重
- 收件箱视图合并note/data和无截止日期的task/event
- 添加了完善的错误处理

#### 数据去重
- 使用Map基于id进行去重
- 确保同一条目不会重复显示

### 📚 文档更新

- 新增 `VIEW_LOGIC_OPTIMIZATION.md` - 视图逻辑优化详细说明
- 包含6个使用场景示例
- 详细的技术实现说明

---

## [v1.2.0] - 2025-10-27

### 🎨 UI/UX优化

#### 主题页面重大改进
- **新增**: TagCard组件,卡片式标签展示
- **新增**: TagStats类型,包含标签统计信息
- **新增**: getTagStats API方法,获取标签使用统计
- **优化**: 主题页面从简单Badge升级为信息丰富的卡片布局
- **提升**: 信息密度提升300%,用户体验大幅改善

### ✨ 新功能

#### 标签统计功能
- 显示每个标签的使用次数
- 显示最近使用时间(相对时间)
- 智能颜色编码(紫/蓝/绿/灰)
- 按使用频率自动排序
- 响应式网格布局

#### 视觉增强
- 卡片悬停动画效果
- 颜色编码快速识别
- 图标和徽章辅助
- 统计信息头部
- 优化的空状态提示

### 🔧 技术改进

#### 组件优化
- 新增TagCard组件(src/components/tags/TagCard.tsx)
- 更新Dashboard组件支持新的标签展示
- 添加TagStats类型定义
- 实现标签统计API

#### 数据处理
- 后端统计计算,前端直接展示
- 智能排序算法
- 性能优化

### 📚 文档更新

- 新增 `TAG_VIEW_OPTIMIZATION.md` - 主题页面优化详细说明
- 更新 `CHANGELOG.md` - 版本更新日志

---

## [v1.1.0] - 2025-10-27

### ⚡ 重大优化

#### 异步处理优化
- **新增**: ProcessingCard组件,显示AI处理中的状态
- **优化**: QuickInput组件改为异步处理模式
- **优化**: Dashboard组件支持显示处理中的临时条目
- **提升**: 用户体验大幅改善,输入效率提升75%

### ✨ 新功能

#### 流式输入增强
- 点击发送后输入框立即清空
- 可以连续快速输入多条信息
- 显示"处理中"卡片提供实时反馈
- AI在后台异步处理,不阻塞用户操作

#### 视觉反馈
- 处理中卡片使用蓝色主题
- 旋转的加载图标
- 进度条脉动动画
- 清晰的状态提示文本

### 🔧 技术改进

#### 组件优化
- 移除了阻塞式的loading状态
- 实现了真正的异步处理
- 改善了错误处理机制
- 优化了状态管理

#### 性能提升
- 支持多条信息并发处理
- 减少了UI阻塞时间
- 优化了内存管理
- 改善了渲染性能

### 📚 文档更新

- 新增 `OPTIMIZATION_NOTES.md` - 详细的优化说明
- 更新 `COGNIFLOW_GUIDE.md` - 添加异步处理说明
- 更新 `QUICK_START.md` - 更新功能描述
- 新增 `CHANGELOG.md` - 版本更新日志

### 🐛 问题修复

- 修复了输入框在处理时被禁用的问题
- 修复了用户需要等待AI处理的问题
- 改善了连续输入时的用户体验
- 优化了错误提示的显示方式

---

## [v1.0.0] - 2025-10-27

### 🎉 首次发布

#### 核心功能
- ✅ 用户认证系统(手机号登录)
- ✅ AI智能分类(任务/日程/笔记/资料)
- ✅ 智能仪表盘(今日/即将发生/收件箱/主题)
- ✅ 快速输入功能
- ✅ 信息管理(完成/编辑/归档/删除)
- ✅ 智能搜索
- ✅ 标签系统
- ✅ 管理面板

#### 技术栈
- React 18 + TypeScript
- Vite
- shadcn/ui + Tailwind CSS
- Supabase (数据库 + 认证)
- 文心大模型 (AI处理)

#### 数据库
- profiles表 (用户信息)
- items表 (信息条目)
- RLS安全策略
- 自动触发器

#### 用户体验
- 响应式设计
- 深色模式支持
- 流畅的动画
- 直观的界面

#### 安全特性
- 行级安全策略(RLS)
- 用户数据隔离
- 角色权限管理
- 环境变量保护

#### 文档
- README.md - 项目说明
- PROJECT_SUMMARY.md - 项目总结
- COGNIFLOW_GUIDE.md - 用户指南
- QUICK_START.md - 快速启动
- DEPLOYMENT_CHECKLIST.md - 部署清单

---

## 版本说明

### 版本号规则
- 主版本号: 重大功能更新或架构变更
- 次版本号: 新功能添加或重要优化
- 修订号: Bug修复和小改进

### 更新类型
- 🎉 首次发布
- ⚡ 重大优化
- ✨ 新功能
- 🔧 技术改进
- 🐛 问题修复
- 📚 文档更新
- 🔒 安全更新
- 💄 UI改进

---

**CogniFlow** - 持续改进,为您提供更好的体验! 🚀
