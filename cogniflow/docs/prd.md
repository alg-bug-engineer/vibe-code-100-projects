# CogniFlow智能流笔记需求文档

## 1. 产品概述

### 1.1 产品名称
CogniFlow (智能流笔记)

### 1.2 产品描述
CogniFlow是一款由大语言模型(LLM)驱动的智能信息管理工具，旨在解决用户在日常工作和生活中因使用线性、非智能工具而导致的信息淹没和关键事项遗漏问题。产品核心理念是「你只管记录，我负责管理」。

### 1.3 产品愿景
提供流式输入界面，用户只需像发消息一样输入任何碎片化信息，后端LLM会立即对信息进行意图识别、实体提取和自动归档，然后在动态的情境感知仪表盘上，在正确的时间向用户展示正确的信息。

## 2. 核心功能

### 2.1 流式输入模块
- 万能输入框：App底部类微信输入框或浮动操作按钮，始终可见或易于访问
- 快速处理反馈：输入后立即清空，提供处理状态反馈
- 支持纯文本输入，一键发送
- URL智能识别：自动识别输入内容中的URL链接
- **对话式查询功能**：
  - 意图识别：AI判断输入是「新增条目」还是「查询条目」
  - 查询处理：解析查询中的关键参数（时间范围、事项类型等）
  - 结果呈现：在输入框上方以临时气泡或可收起浮层形式展示查询结果
  - 支持自然语言查询（如「我今天有什么事？」「查询下周的会议」）
  - 可选特殊前缀触发查询模式（如 ? 或 /q）

### 2.2 LLM处理引擎
- 意图分类：识别Task(任务)、Event(日程)、Note(笔记/灵感)、Data(信息/资料)、URL(链接)五种类型
- 实体提取：提取时间、动作、人物、地点、主题等结构化数据
- 自动归档与路由：根据意图和实体自动分配到对应智能视图
- 智能标签：基于实体提取自动创建或关联标签
- URL内容抓取：当识别到URL时，自动访问链接并提取网站内容
- 网站梗概生成：基于抓取的网站内容生成简洁的梗概介绍
- **重复性任务识别**：识别并解析常见的重复性描述（如「每周五」「每月最后一天」），自动填充重复规则
- **冲突检测**：自动检测时间重叠的日程类型条目，标记冲突状态

### 2.3 智能仪表盘
- 今日视图：显示当天的任务和日程，支持优先级排序和过期提醒
- 即将发生视图：显示未来的任务和日程，按时间分组展示
- 收件箱/灵感视图：显示无明确时效的笔记和资料信息
- 链接库视图：专门展示URL链接卡片，包含网站标题、梗概介绍、访问时间等信息
- 主题/标签视图：显示自动生成的标签，支持标签关联查看
  - 二级选项tab：支持按不同维度（时间、类型、频次等）筛选标签
  - 历史条目展示：按时间顺序逆序呈现该标签下的所有历史记录
  - **日历视图**：新增日历子视图，提供月/周/日历布局，以时间维度直观展示所有任务和日程
- **冲突事项高亮**：时间重叠的日程条目以红色边框和警告图标突出显示

### 2.4 信息条目管理
- 任务完成：Task条目支持完成勾选
- 快捷编辑：支持快速修改LLM识别的实体信息
- 重新分类：支持手动转换信息类型
- 归档/删除：支持信息的归档和删除操作
- URL卡片管理：支持重新抓取网站内容、编辑梗概、添加备注
- **重复性任务管理**：
  - 支持创建重复性任务或日程
  - 重复规则设置：不重复、每天、每周、每月、每年
  - 结束条件：永不、特定日期、N次后
  - 实例编辑：支持「仅修改此项」或「修改此项及所有未来项」

### 2.5 智能搜索
- 语义搜索：支持关键词和自然语言搜索
- 关联搜索：基于标签和实体进行智能关联
- URL内容搜索：支持在网站梗概内容中进行搜索
- **对话式查询**：通过输入框直接进行自然语言查询

### 2.6 智能助手功能
- AI驱动的意图识别和实体提取
- 智能信息分类和自动归档
- 情境感知的信息推送和提醒
- 主动准备建议(如检测到出差自动推送准备行李提醒)
- 网站内容智能解析和梗概生成
- **日程冲突检测和提醒**
- **重复性任务自动生成和管理**

## 3. 技术架构要求

### 3.1 前端技术
- 跨平台框架(Flutter或React Native)实现Web、iOS、Android同步
- 本地存储(SQLite/IndexedDB)支持离线访问和快速启动
- 日历组件库集成（如FullCalendar或react-big-calendar）

### 3.2 后端技术
- API服务器(Python/FastAPI或Node.js/Express)
- 数据库(PostgreSQL或MongoDB)
- LLM服务集成(Google Gemini、OpenAI GPT-4或国内AI服务)
- 异步任务处理(Celery/RQ)
- WebSocket或推送通知支持实时更新
- 网页抓取服务：支持URL内容提取和解析
- **定时任务服务**：用于重复性任务实例生成和冲突检测

### 3.3 数据存储
- raw_items表：存储用户原始文本输入
- processed_items表：存储LLM处理后的结构化数据
- url_items表：存储URL链接信息、网站内容和梗概数据
- **扩展字段**：
  - has_conflict：布尔型，标记是否存在时间冲突
  - recurrence_rule：字符串，存储iCalendar RRULE重复规则
  - recurrence_end_date：时间戳，重复结束日期（可选）
  - master_item_id：关联字段，指向重复任务的母版条目
- 支持数据持久化存储和云端同步

## 4. 设计风格
采用Calm Tech(平静技术)设计理念，使用柔和、专业的色调(蓝、灰、白)，辅以清晰的行动色(绿色或蓝色)。界面聚焦、轻量，启动快、响应快。冲突事项使用红色高亮警告色。

## 5. 用户交互

### 5.1 核心交互流程
- 用户输入 → 短暂延迟 → 信息卡片智能出现在对应视图
- 右滑标记任务完成
- 左滑推迟任务
- 点击标签查看关联信息
- URL输入 → 自动抓取 → 生成梗概卡片 → 归档到链接库
- **查询交互**：输入查询语句 → AI识别查询意图 → 浮层展示结果 → 点击外部或ESC关闭
- **冲突提醒**：鼠标悬停警告图标显示冲突详情
- **日历交互**：点击日历事项弹出详情或编辑对话框

### 5.2 界面布局
- 顶部：日期显示和搜索图标
- 内容区：卡片列表展示
- 底部导航：今日、即将发生、收件箱、链接库、主题五个视图
- 悬浮按钮：流式输入入口
- 主题视图二级导航：支持标签、历史、**日历**三个tab切换
- **查询结果浮层**：输入框上方临时展示查询结果

## 6. 目标用户
- 忙碌的专业人士/管理者
- 知识工作者/创意人士  
- 高组织需求的学生/个人用户